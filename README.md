# Python 代码查重工具

一个基于多种高级相似度算法的Python代码查重工具，具备灵活的文件管理、智能辅助判定、历史追溯和数据可视化等丰富功能。

## 功能特性

### 1. 灵活的文件导入与管理
- **多种导入方式**：支持批量导入整个目录、或单独选择一个/多个文件进行查重。
- **累积式导入**：支持分批、多次导入，所有文件会自动累积并去重，便于构建复杂的查重任务。
- **可视化文件管理**：在左侧文件列表中清晰展示所有待查重文件。
- **动态编辑列表**：
    - **单个移除**：通过点击文件右侧的 "✕" 按钮，可以随时从列表中移除单个文件。
    - **一键重置**：通过 "重置所有导入" 按钮，可以立即清空整个文件列表。

### 2. 多维度的智能查重引擎
- **混合分析模型**：结合了基于**Token序列**的经典算法和基于**抽象语法树(AST)**的现代结构分析算法，查重维度更丰富，结果更精准。
- **代码归一化**：在分析前对代码进行预处理，移除注释、文档字符串，并将变量名、函数名等标识符归一化，有效对抗“换名抄袭”等手段。
- **综合可疑度评估**：通过可配置的权重，将多个单一指标融合成一个综合分数，为抄袭判定提供最主要的参考依据。

### 3. 智能辅助与可视化
- **自动抄袭标记**：可开启此功能，对“综合可疑度”超过阈值（如80%）的代码对进行自动标记，提高筛选效率。
- **智能弹窗提醒**：在每次会话首次触发自动标记时，会弹窗提醒用户，并提供“本次登录不再提醒”和“不再自动标记”的灵活选项。
- **抄袭关系网络图**：
    - **一键生成与查看**：点击按钮即可根据当前查重结果，生成可视化的关系网络图，抄袭“团伙”和传播链条一目了然。
    - **便捷导出**：支持将生成的关系图导出为PNG或SVG等格式的图片文件。
- **代码高亮对比**：双击结果条目，可在左右两侧并排显示两份代码，并精确高亮显示内容上匹配的代码片段。

### 4. 完善的历史与判定管理
- **会话持久化**：所有查重结果、文件列表和元数据（如分析时间）都会被自动保存为一个独立的“分析会话”。
- **智能会话描述**：能自动识别导入方式，为来自单个目录的导入生成更具可读性的会话描述。
- **历史追溯**：可随时在历史记录列表中加载过去的分析会话，查看所有历史结果。
- **人工抄袭判定**：
    - **快速标记**：通过右键菜单，可以方便地对任意结果进行“标记为抄袭”或“取消标记”的操作。
    - **备注系统**：支持为每一个抄袭判定添加详细的文字备注，方便记录和追溯。
    - **状态同步**：所有标记和备注都会被实时保存，并同步更新到“抄袭管理”视图和历史记录中。

### 5. 便捷的导出功能
- **导出抄袭报告**：一键导出当前所有被标记为抄袭的记录的详细报告（JSON格式）。
- **导出抄袭文件**：一键导出所有被标记为抄袭的原始代码文件，方便归档。

## 安装和运行

### 环境要求
- Python 3.9+
- PyQt5
- NetworkX
- Matplotlib

### 安装依赖
```bash
pip install -r requirements.txt
```

### 运行程序
```bash
python main.py
```

## 使用说明

### 文件导入与管理
1. **导入目录/文件**：点击 "导入目录" 或 "导入文件" 按钮，分批、多次添加代码文件。
2. **移除文件**：点击左侧文件列表中，文件项右侧的 "✕" 按钮。
3. **重置列表**：点击左侧文件列表下方的 "重置所有导入" 按钮。

### 查重与结果查看
1. **开始查重**：添加完所有文件后，点击 "开始查重"。
2. **切换指标**：在右上方的“指标显示/排序控制”区域，通过勾选/取消复选框，可以动态显示或隐藏不同的指标列。表格将默认按照最左侧的可见指标列进行降序排序。
3. **查看简介**：鼠标悬停在指标复选框上，可以查看该指标的详细介绍。
4. **详细对比**：双击中间结果列表中的任意条目，可在右侧“代码对比”视图中查看高亮详情。

### 高级功能
1. **自动/手动标记**：
    1. 在结果列表下方，可勾选/取消“启用自动标记功能”。
    2. 在结果列表项上右键，可进行手动的“标记/取消抄袭”和“编辑备注”。
2. **查看/导出关系图**：
    1. 点击结果列表下方的“查看抄袭关系图”，会弹出一个包含可视化网络图的窗口
    2. 点击“导出抄袭关系图”，可将当前关系图保存为图片文件。
3. **历史记录**：
    1. 登录时间记录：记录并显示用户登录时间
    2. 分析会话管理：自动保存每次导入的查重结果
    3. 历史结果查看：支持直接显示过往的查重结果
    4. 导出历史功能：支持导出抄袭报告和抄袭文件

## 文件结构

```
pycode_checker/
├── main.py                   # 程序入口
├── requirements.txt            # 依赖包列表
├── model/                      # 数据模型与核心逻辑
│   ├── file_manager.py       # 文件管理
│   ├── history_manager.py    # 历史记录管理
│   ├── graph_handler.py      # 图生成与处理
│   └── similarity/           # 相似度分析模块
│       ├── __init__.py
│       ├── analyzer.py       # 核心分析器
│       ├── result.py         # 结果数据结构
│       ├── metrics.py        # 各个相似度算法
│       ├── ast_handler.py    # AST处理工具
│       └── preprocessors.py  # 预处理器
├── view/                       # 用户界面
│   ├── main_window.py        # 主窗口 (组装)
│   ├── detail_view.py        # 详细对比视图
│   ├── history_view.py       # 历史记录相关UI
│   ├── dialogs.py            # 自定义对话框
│   └── panels/               # UI面板模块
│       ├── __init__.py
│       ├── left_panel.py
│       ├── center_panel.py
│       └── right_panel.py
├── controller/                 # 控制器
│   └── main_controller.py    # 主控制器
└── history/                    # 历史记录存储目录
    └── analysis_history.json
```

## 技术特点

- **模块化设计**：采用清晰的MVC架构，并将UI层进一步拆分为高内聚的“面板”模块，极大提高了代码的可读性和可维护性。
- **混合分析引擎**：结合了基于Token（词法）和AST（语法）的多种分析维度，实现了对代码从表面到结构的深度检测。
- **数据可视化**：使用NetworkX和Matplotlib生成直观的抄袭关系网络图，辅助用户进行宏观分析。
- **数据持久化**：使用JSON格式对分析会话和抄袭判定进行序列化，确保所有工作都可以被保存和追溯。
- **用户友好**：提供包括右键菜单、Tooltip简介、可拖拽面板、动态列显示在内的多项功能，提升用户体验。
- **可扩展性**：易于添加新的相似度算法和功能模块

## 注意事项

- 程序首次运行时会自动创建 `history` 目录，用于存储所有分析会话。
- 所有的抄袭判定（包括自动和手动）和备注信息，都会与分析会话一起保存在历史记录中。
- 所有导出的文件（抄袭报告、抄袭文件、关系图）都会自动添加时间戳，以避免文件名冲突。
- `matplotlib` 绘图时，为了正常显示中文，代码中默认使用了“黑体”(SimHei)，请确保您的系统中包含此字体或类似的无衬线中文字体。
- 建议定期备份 `history` 目录下的 `analysis_history.json` 文件，以防数据丢失。
